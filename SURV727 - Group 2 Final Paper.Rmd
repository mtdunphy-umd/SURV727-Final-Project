---
title: "Fundamentals of Computing and Data Display"
author: "Michael Dunphy, Niall Johnson"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    df_print: paged
  pdf_document:
    toc: yes
    df_print: kable
subtitle: Group 2 Term Paper
---

```{r, include = FALSE}
library(knitr)
library(tidyverse)

# R wrapper for the Open FEC API https://rdrr.io/github/robinspollak/R.openFEC/man/
library(R.openFEC)
library(plyr)
library(dplyr)
library(httr)
library(readr)
library(stringr)
library(magrittr)
library(factoextra)
library(corrplot)
library(lubridate)
library(gtrendsR)
library(reshape2)

fec_key <- "xVmzxja3eXKa9VgaCHCfLPfcj2qQxXMCXrFcvq2F"
wd <- getwd()

```

## Introduction

Since 2010 and the controversial decision of Citizens United vs. Federal Election Commission (FEC), the amount of money spent on political campaigns has risen exponentially. In 2010, a midterm election where infamously Republicans picked up a half dozen seats in the Senate and more than 60 seats in the House, political expenditures totaled around 3.6 billion dollars. In 2022, that number is [projected](https://www.opensecrets.org/elections-overview/cost-of-election?cycle=2020&display=T&infl=N) to be around $8.9B.

Candidates with [more money win more often](https://www.opensecrets.org/elections-overview/winning-vs-spending), so fundraising has become a critical indicator of election forecasting and understanding the current political climate.

Major partisan events that dominate the greater political discussion often cause a mass influx of money to political campaigns. With each fundraising cycle there are candidates that perform above and below expectations based on candidate quality and the overall political climate. Our goal is to identify those trends in contributions that correlate with significant political shocks during the 2022 midterm cycle, as well as identify characteristics of candidates that affected fundraising performance. In our analysis, we build 3 linear models to identify which characteristics were significant in fundraising among house candidates, senate candidates, and candidates running in competitive districts. We also build 3 logistic models predicting change of win in the general election among the same groups - controlling for the characteristics of their districts. We conduct principal component analysis to identify which variables are the most predictive for our model. We also utilize data visualizations such as comparing top fundraisers by party and office. We also plot fundraising numbers over time through the 2022 election year by day and week.

## Data

Data collected for this analysis came from multiple sources. To start, we collected data from 538’s “2022 Primary Project” [GitHub repository](https://github.com/fivethirtyeight/data/tree/master/primary-project-2022) which tracked the 2022 midterm primary candidates at the federal level. We processed this data to extract general election candidates by filtering candidates based on whether or not they won their primary election (or if there was one, their runoff election). 900 candidates were pulled with information on endorsements, incumbency status, race, and gender of the candidates. 

Contributions to candidates were provided by the [FEC](https://www.fec.gov/) which tracks federal level campaign finance information. We tried using the FEC API, relying on the [R.openFEC package](https://rdrr.io/github/robinspollak/R.openFEC/man/) in R, but were unsuccessful in processing the data in a reasonable time, and thus shifted methods to pulling data straight from the FEC website. This data included ‘Candidate-committee linkages’ and ‘Contributions by individuals’ on the [bulk data webpage](https://www.fec.gov/data/browse-data/?tab=bulk-data). The 538 general election candidate data set was joined with the candidate-committee linkages FEC data set by office, state, district, and candidate last name to get FEC candidate IDs and committee IDs that will be used later on into the analysis. 

Individual contribution bulk data was brought into R and found to have discrepancies and errors. Due to this, we manually pulled [individual state receipts](https://www.fec.gov/data/receipts/individual-contributions/?two_year_transaction_period=2022&min_date=01%2F01%2F2022&max_date=12%2F31%2F2022&recipient_committee_type=S&recipient_committee_type=H) for the year of 2022 using custom filters and unioned together in R. Receipt data is up to the last FEC report date which was 10/19/2022. This data was joined with our candidate data set on candidate ID and committee ID to view total fundraising numbers for each candidate as well as the timeline of contributions.

Google trends data was provided by Google, using the [gtrendsR R package](https://cran.r-project.org/web/packages/gtrendsR/gtrendsR.pdf) to identify key issues that were of high salience in this election cycle. We wanted to focus on the issue of abortion and Trump’s influence which is why we searched the following terms: ‘abortion’, ‘supreme court’, ‘Trump’, ‘FBI’, and ‘crime’. Crime was included as a comparison as it was another major issue for many voters this cycle.

District level data was provided by [Dave’s Redistricting App](https://davesredistricting.org/maps#home) (DRA) for each state. This data was manually collected for each state and inputted into this [google sheet](https://docs.google.com/spreadsheets/d/15UnM1AwmAdRYDmmO-F85M5VrMG7TYAiYW2-ofoGf3ic/edit?usp=sharing). The sources of data and processing done to calculate these values for districts can be viewed on [DRA’s website](https://davesredistricting.org/maps#aboutdata). Data that was used included the percentage of white voters in 2020, the 2020 presidential vote share for each party, and the composite score for each party for each district. Composite scores are the mean share of the votes for presidential, senate, governor, and attorney general races from 2016 to 2020 for each party (2016 to 2021 for districts in New Jersey and Virginia). Only Utah’s districts did not have composite score data.

Election result data was manually collected for the [New York Times Midterm Tracker](https://www.nytimes.com/interactive/2022/11/08/us/elections/results-senate.html?action=click&pgtype=Article&state=default&module=election-results&context=election_recirc&region=NavBar) for house and senate candidates and inputted into this [google sheet](https://docs.google.com/spreadsheets/d/1azMpRjQ9sRgW_ULf6qvpouKnwAHWRi_eY1U-RnLPKjI/edit?usp=sharing). During this process, we identified discrepancies between our candidate data and the information shown on NYT (a deceased house incumbent and districts that had no opponent). We used this information to filter districts in our final data set used for analysis.

```{r,  warning=FALSE}

# load 538 primary candidates
dem <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/primary-project-2022/dem_candidates.csv")
rep <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/primary-project-2022/rep_candidates.csv")

# District data provided by Dave's Redistricting App https://davesredistricting.org/maps#home
# Each state's congressional district data was manually exported and combined into a csv
dra_house <- read.csv(paste(wd, "/input data/", "DRA Data - House Districts .csv", sep=''))
dra_senate <- read.csv(paste(wd, "/input data/", "DRA Data - Senate Districts.csv", sep=''))

# Collecting data from the FEC
# candidate data for the 2021-2022 cycle pulled from here: https://www.fec.gov/data/browse-data/?tab=bulk-data
# description of file: https://www.fec.gov/campaign-finance-data/all-candidates-file-description/

header <- "CAND_ID|CAND_NAME|CAND_ICI|PTY_CD|CAND_PTY_AFFILIATION|TTL_RECEIPTS|TRANS_FROM_AUTH|TTL_DISB|TRANS_TO_AUTH|COH_BOP|COH_COP|CAND_CONTRIB|CAND_LOANS|OTHER_LOANS|CAND_LOAN_REPAY|OTHER_LOAN_REPAY|DEBTS_OWED_BY|TTL_INDIV_CONTRIB|CAND_OFFICE_ST|CAND_OFFICE_DISTRICT|SPEC_ELECTION|PRIM_ELECTION|RUN_ELECTION|GEN_ELECTION|GEN_ELECTION_PRECENT|OTHER_POL_CMTE_CONTRIB|POL_PTY_CONTRIB|CVG_END_DT|INDIV_REFUNDS|CMTE_REFUNDS"

base <- toString(read_file(paste(wd, "/input data/", "weball22.txt", sep=''))[1])

init <- file(paste(wd, "/output data/", "weball22_header.txt", sep=''))
writeLines(paste(append(header, base), sep = "|"), init)
close(init)

fec_candidate_info <- read.table(paste(wd, "/output data/", "weball22_header.txt", sep=''), sep= "|", header=TRUE)

# fec data has some misaligned columns using the read.table function. Data was imported to google sheets and manually modified to get columns in the correct order.
# google sheet: https://docs.google.com/spreadsheets/d/150dhkj1xrFwfi43ouYqu0LFLcj4jRMetXSRucYLTDIk/edit?usp=sharing

fec_candidate_info_fixed <- read.csv(paste(wd, "/input data/", "FEC Candidate Data - Fixed.csv", sep=''))
fec_candidate_info_fixed$FEC_index <- row.names(fec_candidate_info_fixed)

# contributions by individuals downloaded in bulk from here: https://www.fec.gov/data/browse-data/?tab=bulk-data
# description of file: https://www.fec.gov/campaign-finance-data/contributions-individuals-file-description/
# the file was too large to be imported into the github repository
# the file can be found in this google folder: https://drive.google.com/drive/folders/172eM7HDJ1CMVMPgpaN74dY3bzY9piSsz?usp=sharing
# the folder can be added to the input folder in the repository to reproduce the results
# added header info to the top of the intcont.txt file
fec_receipts <- read.table(paste(wd, "/input data/indiv22/", "itcont.txt", sep=''), sep= "|", header=TRUE, fill=TRUE)
write.csv(fec_receipts, paste(wd, "/output data/", "fec_receipts.csv", sep=''))

# the bulk data set showed discrepancies and errors so the data was manually pulled by individual states and joined together.
# the files were too large to be imported into the github repository
# the file can be found in this google folder: https://drive.google.com/drive/folders/10LzNSv9ucwlUsFGJbJP6nx2qP5cVkLFJ?usp=sharing
# the folder can be added to the input folder in the repository to reproduce the results
folder <- paste(wd, "/input data/FEC Receipts", sep='')
csv_files <- list.files(folder, pattern = "*.csv")

df_list <- list()
for (file in csv_files) {
  df <- read_csv(file.path(folder, file), show_col_types = FALSE) %>%
          mutate_all(as.character)
  df_list[[file]] <- df
}

fec_receipts_combined <- dplyr::bind_rows(df_list)
write.csv(fec_receipts_combined, paste(wd, "/output data/", "fec_receipts_combined.csv", sep=''))

# to link candidates to their committees, FEC provides a bulk data set that can be found here under 'Candidate-committee linkages': https://www.fec.gov/data/browse-data/?tab=bulk-data
# a description of the file can be found here: https://www.fec.gov/campaign-finance-data/candidate-committee-linkage-file-description/

# the ccl.txt file was modified to include the header: ccl_header_file.csv
fec_candidate_committees <- read.table(paste(wd, "/input data/", "ccl.txt", sep=''), sep= "|", header=TRUE, fill=TRUE)

# select candidate id, committee id, linkage id
fec_candidate_committees_trimmed <- fec_candidate_committees %>%
                                      select(CAND_ID, CMTE_ID, LINKAGE_ID)

write.csv(fec_candidate_committees_trimmed, paste(wd, "/output data/", "fec_candidate_committees_trimmed.csv", sep=''))

# Election results were collected manually off of the NYT Election tracker: https://www.nytimes.com/interactive/2022/11/08/us/elections/results-senate.html?action=click&pgtype=Article&state=default&module=election-results&context=election_recirc&region=NavBar
# Data was collected and inputed into this spreadsheet: https://docs.google.com/spreadsheets/d/1azMpRjQ9sRgW_ULf6qvpouKnwAHWRi_eY1U-RnLPKjI/edit?usp=sharing

nyt_election_results <- read.csv(paste(wd, "/input data/", "NYT Election Tracker Data - General Election Candidates.csv", sep='')) %>%
                          select(State, Office, District, Candidate, Winner.)

```

All data processing can be viewed in R markdown file.
```{r, include = FALSE}

# process 538 primary candidate data 
dem["Party"] <- "DEM"
rep["Party"] <- "GOP"

full_primary_candidates <- rbind.fill(dem, rep)
head(full_primary_candidates)

write.csv(full_primary_candidates, paste(wd, "/output data/", "full_primary_candidates.csv", sep=''))

# grab general election candidates 
full_primary_candidates["General.Election.Candidate"] <- FALSE

for (i in 1:nrow(full_primary_candidates)) {
  # determine in general election candidate
  if (full_primary_candidates[i, "Primary.Outcome"] == "Won") {
    full_primary_candidates[i, "General.Election.Candidate"] <- TRUE
  } else if (full_primary_candidates[i, "Primary.Outcome"] == "Made runoff") {
    if (full_primary_candidates[i, "Runoff.Outcome"] == "Won" || full_primary_candidates[i, "Runoff.Outcome"] == "" || is.null(full_primary_candidates[i, "Runoff.Outcome"])) {
      full_primary_candidates[i, "General.Election.Candidate"] <- TRUE
    }
  }
}

full_general_candidates <- full_primary_candidates %>%
                            filter(General.Election.Candidate == TRUE) %>%
                            filter(Office == "Representative" | Office == "Senator (unexpired term)" | Office == "Senator")

full_general_candidates$Office[full_general_candidates$Office == "Senator (unexpired term)"] <- "Senator"
full_general_candidates <- full_general_candidates %>%
                            filter(duplicated(Candidate) == FALSE)


full_general_candidates$index <- row.names(full_general_candidates)
head(full_general_candidates)
write.csv(full_general_candidates,  paste(wd, "/output data/", "full_general_candidates.csv", sep=''))

```

```{r, include = FALSE}

# DRA processing
# append data sets 
full_dra_districts <- rbind.fill(dra_house, dra_senate)
head(full_dra_districts)

# create 2020 white percentage for each district
full_dra_districts["2020.White.%"] <- as.double(full_dra_districts$White.2020.Total) / as.double(full_dra_districts$Total.2020.Total)

# create 2020 presidential vote share for each party
full_dra_districts["Dem.2020.Pres.%"] <- as.double(full_dra_districts$Dem.2020.Pres) / as.double(full_dra_districts$Total.2020.Pres)
full_dra_districts["Rep.2020.Pres.%"] <- as.double(full_dra_districts$Rep.2020.Pres) / as.double(full_dra_districts$Total.2020.Pres)

# create 2016-2020 composite score for each party
# composite scores are the mean presidential, senate, governor, and attorney general vote shares in the given period
# VA and NJ have composite scores going from 2016-2021
# UT is missing composite scores completely
full_dra_districts["Dem.2016-2020.Comp.%"] <- as.double(full_dra_districts$Dem.2016.2020.Comp) / as.double(full_dra_districts$Total.2016.2020.Comp)
full_dra_districts["Rep.2016-2020.Comp.%"] <- as.double(full_dra_districts$Rep.2016.2020.Comp) / as.double(full_dra_districts$Total.2016.2020.Comp)

full_dra_districts["Dem.2016-2021.Comp.%"] <- as.double(full_dra_districts$Dem.2016.2021.Comp) / as.double(full_dra_districts$Total.2016.2021.Comp)
full_dra_districts["Rep.2016-2021.Comp.%"] <- as.double(full_dra_districts$Rep.2016.2021.Comp) / as.double(full_dra_districts$Total.2016.2021.Comp)

full_dra_districts$`Dem.Comp.%` <- ifelse(is.na(full_dra_districts$`Dem.2016-2021.Comp.%`), full_dra_districts$`Dem.2016-2020.Comp.%`, full_dra_districts$`Dem.2016-2021.Comp.%`)
full_dra_districts$`Rep.Comp.%` <- ifelse(is.na(full_dra_districts$`Rep.2016-2021.Comp.%`), full_dra_districts$`Rep.2016-2020.Comp.%`, full_dra_districts$`Rep.2016-2021.Comp.%`)

full_dra_districts["Dem-Rep.2020"] <- full_dra_districts["Dem.2020.Pres.%"] - full_dra_districts["Rep.2020.Pres.%"]
full_dra_districts["Dem-Rep.Comp"] <- full_dra_districts["Dem.Comp.%"] - full_dra_districts["Rep.Comp.%"]

# select office, id, state, and created columns
full_dra_districts.trimmed <- full_dra_districts %>%
                                select(DRA.Office, ID, State, `Dem.2020.Pres.%`, `Rep.2020.Pres.%`, `Dem.Comp.%`, `Rep.Comp.%`, `2020.White.%`, `Dem-Rep.2020`, `Dem-Rep.Comp`)

# convert ID to char type for joining later
full_dra_districts.trimmed$ID <- as.character(full_dra_districts.trimmed$ID)

head(full_dra_districts.trimmed)

write.csv(full_dra_districts.trimmed,  paste(wd, "/output data/", "full_dra_districts.trimmed.csv", sep=''))

```

```{r, include = FALSE}

# FEC candidate matching processing
# match general election candidates from 538 with candidates in FEC candidate data seton last name, district, state, office, and party

# prep 538 data set
head(full_general_candidates)

full_general_candidates.matching <- select(full_general_candidates, index, Candidate, State, Office, District, Party)

# remove parts of name that interferes with grabbing last name
full_general_candidates.matching$Candidate_processed <- str_pad(full_general_candidates.matching$Candidate, width=1, side="right")
full_general_candidates.matching$Candidate_processed <- gsub(" Sr. ", "", full_general_candidates.matching$Candidate_processed)
full_general_candidates.matching$Candidate_processed <- gsub(" Jr. ", "", full_general_candidates.matching$Candidate_processed)
full_general_candidates.matching$Candidate_processed <- gsub(" II ", "", full_general_candidates.matching$Candidate_processed)
full_general_candidates.matching$Candidate_processed <- gsub(" III ", "", full_general_candidates.matching$Candidate_processed)

# extract last name and store in new column
full_general_candidates.matching$Last_name <- word(full_general_candidates.matching$Candidate_processed, - 1) 
full_general_candidates.matching$Last_name <- toupper(full_general_candidates.matching$Last_name)
full_general_candidates.matching$Last_name <- gsub(" ", "", full_general_candidates.matching$Last_name)

# change districts to match district format with FEC data set
full_general_candidates.matching$District_processed <- full_general_candidates.matching$District
full_general_candidates.matching$District_processed[full_general_candidates.matching$District == "At-Large"] <- 0
full_general_candidates.matching$District_processed[full_general_candidates.matching$District == "N/A"] <- 0

# convert full state names to abbreviated names to match FEC format
states_dict <- c(AL = "Alabama",
                AK = "Alaska",
                AZ = "Arizona",
                AR = "Arkansas",
                CA = "California",
                CO = "Colorado",
                CT = "Connecticut",
                DE = "Delaware",
                FL = "Florida",
                GA = "Georgia",
                HI = "Hawaii",
                ID = "Idaho",
                IL = "Illinois",
                IN = "Indiana",
                IA = "Iowa",
                KS = "Kansas",
                KY = "Kentucky",
                LA = "Louisiana",
                ME = "Maine",
                MD = "Maryland",
                MA = "Massachusetts",
                MI = "Michigan",
                MN = "Minnesota",
                MS = "Mississippi",
                MO = "Missouri",
                MT = "Montana",
                NE = "Nebraska",
                NV = "Nevada",
                NH = "New Hampshire",
                NJ = "New Jersey",
                NM = "New Mexico",
                NY = "New York",
                NC = "North Carolina",
                ND = "North Dakota",
                OH = "Ohio",
                OK = "Oklahoma",
                OR = "Oregon",
                PA = "Pennsylvania",
                RI = "Rhode Island",
                SC = "South Carolina",
                SD = "South Dakota",
                TN = "Tennessee",
                TX = "Texas",
                UT = "Utah",
                VT = "Vermont",
                VA = "Virginia",
                WA = "Washington",
                WV = "West Virginia",
                WI = "Wisconsin",
                WY = "Wyoming")

full_general_candidates.matching$State_processed <- state.abb[match(full_general_candidates.matching$State,state.name)]

head(full_general_candidates.matching)
write.csv(full_general_candidates.matching, paste(wd, "/output data/", "full_general_candidates.matching.csv", sep=''))

```

```{r, include =- FALSE}

# prep FEC data set
head(fec_candidate_info_fixed)

fec_candidate_info_fixed.matching <- select(fec_candidate_info_fixed, FEC_index, CAND_NAME, CAND_PTY_AFFILIATION, CAND_ID, CAND_OFFICE_ST, CAND_OFFICE_DISTRICT)

fec_candidate_info_fixed.matching$Last_Name_FEC <- word(fec_candidate_info_fixed.matching$CAND_NAME, sep = ",", 1)
fec_candidate_info_fixed.matching$Last_Name_FEC <- word(fec_candidate_info_fixed.matching$Last_Name_FEC, sep = " ", 1) 
fec_candidate_info_fixed.matching$Last_Name_FEC <- gsub(" FOR AZ", "", fec_candidate_info_fixed.matching$Last_Name_FEC)

fec_candidate_info_fixed.matching$CAND_PTY_AFFILIATION_processed <- gsub("REP", "GOP", fec_candidate_info_fixed.matching$CAND_PTY_AFFILIATION)

fec_candidate_info_fixed.matching$CAND_OFFICE_DISTRICT <- as.character(fec_candidate_info_fixed.matching$CAND_OFFICE_DISTRICT)

head(fec_candidate_info_fixed.matching)
write.csv(fec_candidate_info_fixed.matching, paste(wd, "/output data/", "fec_candidate_info_fixed.matching.csv", sep=''))

```

```{r, include = FALSE}

# join the general election candidates data set and the fec candidate data set
matched_candidates <- left_join(full_general_candidates.matching, fec_candidate_info_fixed.matching, by = c("Last_name" = "Last_Name_FEC", "Party" = "CAND_PTY_AFFILIATION_processed", "State_processed" = "CAND_OFFICE_ST", "District_processed" = "CAND_OFFICE_DISTRICT"))

head(matched_candidates)
write.csv(matched_candidates, paste(wd, "/output data/", "matched_candidates.csv", sep=''))

# 741 candidates were matched to FEC candidate ID, 161 candidates were not matched to Candidate ID
# candidates that were not matched were manually looked up on the FEC website here: https://www.fec.gov/data/
# data was brought into google sheets and candidate ID was added to the "Processed" tab: https://docs.google.com/spreadsheets/d/1pTsuw7WOrjhXHEpBEHfbM-e2JXXCveodOlBk6RTqjMo/edit?usp=sharing
# any candidate that did not have a candidate ID had their corresponding committee ID added under "Committee_ID_grabbed"

# import processed data set
matched_candidates_processed <- read.csv(paste(wd, "/input data/", "Matched Candidates - Processed.csv", sep=''))
head(matched_candidates_processed)

# select only candidate, candidate id, and committee id columns
matched_candidates_processed_trimmed <- matched_candidates_processed %>%
                                          select(Candidate, CAND_ID, Committee_ID_Grabbed, State_processed)
head(matched_candidates_processed_trimmed)

write.csv(matched_candidates_processed_trimmed, paste(wd, "/output data/", "matched_candidates_processed_trimmed.csv", sep=''))

```

```{r, include = FALSE}
detach(package:plyr)
# FEC receipt processing
# create a trimmed data set for joining purposes
fec_receipts_combined.trimmed <- fec_receipts_combined %>%
                                  select(committee_id, transaction_id, contributor_state, contributor_zip, contributor_id, contribution_receipt_date, contribution_receipt_amount, contributor_aggregate_ytd)
head(fec_receipts_combined.trimmed)

write.csv(fec_receipts_combined.trimmed, paste(wd, "/output data/", "fec_receipts_combined.trimmed.csv", sep=''))

# get contribution totals for each committee id 
fec_receipts_grouped <- as.data.frame(fec_receipts_combined) %>%
                          group_by(committee_id) %>%
                          summarize(total_fundraised = sum(as.double(contribution_receipt_amount)))
head(fec_receipts_grouped)

write.csv(fec_receipts_grouped, paste(wd, "/output data/", "fec_receipts_grouped.csv", sep=''))

```

```{r, include = FALSE}

# join datasets together

# 538 general election candidates with matched data set with FEC candidate IDs
candidates_match <- left_join(full_general_candidates, matched_candidates_processed_trimmed, by = c("Candidate" = "Candidate"))
head(candidates_match)

# Joined data set with FEC committee linkage data set
candidates_match_committee <- left_join(candidates_match, fec_candidate_committees_trimmed, by= c("CAND_ID" = "CAND_ID"))

# add manually grabbed committee ids for candidates who had no candidate id
committee_ids <- list()
for (i in 1:nrow(candidates_match_committee)){
  if (is.na(candidates_match_committee[i, "CMTE_ID"])) {
    candidates_match_committee[i, "CMTE_ID"] <- candidates_match_committee[i, "Committee_ID_Grabbed"]
  }
}
head(candidates_match_committee)

# export joined data set to manually added committee id's that are missing for each candidate
write.csv(candidates_match_committee, paste(wd, "/output data/", "candidates_match_committee.csv", sep=''))

# exported data set added to this google sheet: https://docs.google.com/spreadsheets/d/1t-FL4YxdFEmuivzswmWQ-N8JvJrHWdvEScJp5FoCxXs/edit?usp=sharing
# load processed data set from google sheet with added committee ids
candidates_match_committee_processed <- read.csv(paste(wd, "/input data/", "Candidate ID, Committee ID - Processed.csv", sep=''))

# Joined data set with total fundraising by committee data set
candidates_match_committee_receipts <- left_join(candidates_match_committee_processed, fec_receipts_grouped, by = c("CMTE_ID" = "committee_id"))
head(candidates_match_committee_receipts)

# Joined data set with DRA district data set
candidates_match_committee_receipts_districts <- left_join(candidates_match_committee_receipts, full_dra_districts.trimmed, by = c("Office" = "DRA.Office", "District" = "ID", "State_processed" = "State"))
head(candidates_match_committee_receipts_districts)

# Joined data set with NYT election results data set
candidates_match_committee_receipts_districts_results <- left_join(candidates_match_committee_receipts_districts, nyt_election_results, by = c("Office" = "Office", "District" = "District", "State" = "State", "Candidate" = "Candidate"))
head(candidates_match_committee_receipts_districts_results)

write.csv(candidates_match_committee_receipts_districts_results, paste(wd, "/output data/", "candidates_match_committee_receipts_districts_results.csv", sep=''))

```

```{r, include = FALSE}

# processed joined data set for analysis

# filter out districts with no Democratic or Republican opponent. This accounts for 22 districts.
# Districts included: AL-1, AL-6, AZ-8, AZ-9, FL-5, FL-6, FL-19, IL-7, NY-13, PA-3, PA-13, PA-14, SC-3, SD-At-Large, TX-6, TX-11, TX-19, TX-25, TX-26, TX-31, WI-6, WI-8

# filter out districts that were missing a candidate in the 538 data set. This accounts for 3 districts
# Districts included: MI-4, PA-15, UT Senate

removed_districts <- c("AL-1", "AL-6", "AZ-8", "AZ-9", "FL-5", "FL-6", "FL-19", "IL-7", "NY-13", "PA-3", "PA-13", "PA-14", "SC-3", "SD-At-Large", "TX-6", "TX-11", "TX-19", "TX-25", "TX-26", "TX-31", "WI-6", "WI-8", "MI-4", "PA-15", "UT-N/A")
filtered_data <- candidates_match_committee_receipts_districts_results %>%
                  mutate(full_district = paste(State_processed, "-", as.character(District), sep='')) %>%
                  filter(! full_district %in% removed_districts)

# have district partisanship values correspond with candidate party
for (i in 1:nrow(filtered_data)) {
  filtered_data[i, "Pres_2020"] <- ifelse(filtered_data[i, "Party"] == "DEM", filtered_data[i, "Dem.2020.Pres.%"], ifelse(filtered_data[i, "Party"] == "GOP", filtered_data[i, "Rep.2020.Pres.%"], 0))
  filtered_data[i, "Comp"] <- ifelse(filtered_data[i, "Party"] == "DEM", filtered_data[i, "Dem.Comp.%"], ifelse(filtered_data[i, "Party"] == "GOP", filtered_data[i, "Rep.Comp.%"], 0))
}

# convert gender to a numeric with 1 representing male and 0 representing female
filtered_data$Gender.Num <- ifelse(filtered_data$Gender == "Male", 1, ifelse(filtered_data$Gender == "Female", 0, -99))

# convert race to dummy variables
filtered_data$Race.2 <- ifelse(filtered_data$Race.2 == "", NA, filtered_data$Race.2)
filtered_data$White <- ifelse(!is.na(filtered_data$Race.2), grepl("White", filtered_data$Race.1) | grepl("White", filtered_data$Race.2), grepl("White", filtered_data$Race.1))
filtered_data$White.Num <- ifelse(filtered_data$White, 1, 0)
filtered_data$Black <- ifelse(!is.na(filtered_data$Race.2), grepl("Black", filtered_data$Race.1) | grepl("Black", filtered_data$Race.2), grepl("Black", filtered_data$Race.1))
filtered_data$Black.Num <- ifelse(filtered_data$Black, 1, 0)
filtered_data$Asian <- ifelse(!is.na(filtered_data$Race.2), grepl("Asian", filtered_data$Race.1) | grepl("Asian", filtered_data$Race.2), grepl("Asian", filtered_data$Race.1))
filtered_data$Asian.Num <- ifelse(filtered_data$Asian, 1, 0)
filtered_data$Latino <- ifelse(!is.na(filtered_data$Race.2), grepl("Latino", filtered_data$Race.1) | grepl("Latino", filtered_data$Race.2), grepl("Latino", filtered_data$Race.1))
filtered_data$Latino.Num <- ifelse(filtered_data$Latino, 1, 0)
filtered_data$Middle_Eastern <- ifelse(!is.na(filtered_data$Race.2), grepl("Middle Eastern", filtered_data$Race.1) | grepl("Middle Eastern", filtered_data$Race.2), grepl("Middle Eastern", filtered_data$Race.1))
filtered_data$Middle_Eastern.Num <- ifelse(filtered_data$Middle_Eastern, 1, 0)
filtered_data$Native_American <- ifelse(!is.na(filtered_data$Race.2), grepl("Native", filtered_data$Race.1) | grepl("Native", filtered_data$Race.2), grepl("Native", filtered_data$Race.1))
filtered_data$Native_American.Num <- ifelse(filtered_data$Native_American, 1, 0)

# convert incumbent to a numeric dummy variable
filtered_data$Incumbent.Num <- ifelse(str_detect(filtered_data$Incumbent, "Yes"), 1, 0)

# convert trump endorsement to a numeric dummy variable
filtered_data$Trump.Num <- ifelse(str_detect(filtered_data$Trump, "Yes"), 1, 0)

# convert party committee endorsement to a numeric dummy variable
filtered_data$Party.Committee.Num <- ifelse(str_detect(filtered_data$Party.Committee, "Yes"), 1, 0)

# convert emily's list endorsement to a numeric dummy variable
filtered_data$Emily.s.List.Num <- ifelse(str_detect(filtered_data$EMILY.s.List, "Yes"), 1, 0)

# convert maggie's list endorsement to a numeric dummy variable
filtered_data$Maggie.s.List.Num <- ifelse(str_detect(filtered_data$Maggie.s.List, "Yes"), 1, 0)

# convert sanders endorsement to a numeric dummy variable
filtered_data$Sanders.Num <- ifelse(str_detect(filtered_data$Sanders, "Yes"), 1, 0)

# convert renew america endorsement to a numeric dummy variable
filtered_data$Renew.America.Num <- ifelse(str_detect(filtered_data$Renew.America, "Yes"), 1, 0)

# convert winner to a numeric dummy variable
filtered_data$Winner.Num <- ifelse(filtered_data$Winner, 1, 0)

# convert office to a dummy variable
filtered_data$Senator.Num <- ifelse(!filtered_data$Office == "Representative", 1, 0)

# convert party to a dummy variable
filtered_data$GOP.Num <- ifelse(!filtered_data$Party == "GOP", 1, 0)

# convert total fundraised to numeric value, replacing na's with 0
filtered_data$total_fundraised <- as.double(filtered_data$total_fundraised)
filtered_data$total_fundraised[is.na(filtered_data$total_fundraised)] <- 0

write.csv(filtered_data, paste(wd, "/output data/", "filtered_data.csv", sep=''))

```

```{r, include = FALSE}

# grouped filter data by selected columns to get total fundraised from multiple committees supporting the same candidate
final <- filtered_data %>%
            group_by(Candidate, State, State_processed, District, Party, GOP.Num, Gender.Num, White.Num, Black.Num, Asian.Num, Latino.Num, Middle_Eastern.Num, Native_American.Num, Incumbent.Num, Senator.Num, Trump.Num, Party.Committee.Num, Emily.s.List.Num, Maggie.s.List.Num, Sanders.Num, Renew.America.Num, Winner.Num, `2020.White.%`, `Pres_2020`, `Comp`, `Dem-Rep.2020`, `Dem-Rep.Comp`) %>%
            summarise(total_fundraised_sum = sum(total_fundraised))

# replace NA's with 0
final[is.na(final)] <- 0

final <- as.data.frame(final)
head(final)

write.csv(final, paste(wd, "/output data/", "final.csv", sep=''))

```

## Results

This section presents the main results.

### Data exploration

In this section, we conduct exploratory data analysis to better understand the data. This includes visualizing keyword trends using google trends, plotting fundraising amounts overtime, comparing top fundraising candidates for each party, and compare origin and destination contribution amounts by state.

```{r}

# take filtered data and join it with receipt data to view contributions over time
final_receipt_date <- left_join(filtered_data, fec_receipts_combined.trimmed, by = c("CMTE_ID" = "committee_id")) %>%
                        select(Candidate, State, State_processed, District, Party, `2020.White.%`, Pres_2020, Comp, `Dem-Rep.2020`, `Dem-Rep.Comp`, Gender.Num, White.Num, Black.Num, Asian.Num, Latino.Num, Middle_Eastern.Num, Native_American.Num, Incumbent.Num, Trump.Num, Party.Committee.Num, Emily.s.List.Num, Maggie.s.List.Num, Sanders.Num, Renew.America.Num, Winner.Num, Senator.Num, CAND_ID, CMTE_ID, transaction_id, contributor_state, contributor_zip, contributor_id, contribution_receipt_date, contribution_receipt_amount, contributor_aggregate_ytd)

final_receipt_date$contribution_receipt_amount[is.na(final_receipt_date$contribution_receipt_amount)] <- 0
head(final_receipt_date)

write.csv(final_receipt_date, paste(wd, "/output data/", "final_receipt_date.csv", sep=''))

# filter data for representatives and senators
final_house <- final %>%
                filter(Senator.Num == 0) %>%
                select(-Senator.Num)
head(final_house)

final_senate  <- final %>%
                  filter(Senator.Num == 1) %>%
                  select(-District, -Senator.Num)
head(final_senate)

# filter data for competitive districts
# competitive districts defined as districts with + or - 10 ppt difference in 2020 presidential vote share (DEM - GOP)
final_competitive <- final %>%
                      filter(abs(`Dem-Rep.2020`) <= .1) %>%
                      select(-District)
head(final_competitive)

```

### Fig. 1.
```{r}

require(gtrendsR)
Gtrenddata2022 <- gtrends(c("Abortion", "Trump", "Supreme Court", "Crime", "FBI"), 
               geo = "US", time = "2022-01-01 2022-12-01",onlyInterest = TRUE)

plot(Gtrenddata2022)
```
Fig. 1 tracks the number of Google searches related to the terms 'Abortion', 'Crime', 'FBI', 'Supreme Court', and 'Trump' over the last year. These terms generally reflect the issues that were salient during the 2022 election. Abortion and Trump were most prevalent in the public's mind reflected by the most US Google search hits. Both Abortion and Supreme Court spike around the time of the Dobb's decision that overturned Roe v. Wade. The spike in both FBI and Trump coincides with the Mar-a-Lago raid in early September. Crime was another major issue with voters in this election, yet we don't see large changes in the amount people searched on Google for crime related topics. We also tested 'economy', and it had a similar trend as 'crime', but with less hits.

### Fig. 2.
```{r}

# cumulative sum of contributions
final_receipt_date_party_cumulative <- final_receipt_date %>%
                                  group_by(Party, contribution_receipt_date) %>%
                                  summarise(fundraised = sum(as.double(contribution_receipt_amount))) %>%
                                  mutate(cumulative_fundraised = cumsum(fundraised))

ggplot(final_receipt_date_party_cumulative, aes(x = as.Date(contribution_receipt_date)), y = cumulative_fundraised, color = Party) +
  geom_line(aes(y = cumulative_fundraised, color = Party)) +
  scale_x_date(limits = as.Date(c("2022-01-01", "2022-10-19"))) +
  labs(title = "Fig. 2 Cummulative Sum of Individual Contributions for Federal Candidates of \nEach Party", 
       x = "Day of Contribution", 
       y = "Contribution Amount ($)") +
  scale_color_manual(values = c("GOP" = "red", "DEM" = "blue")) +
  geom_vline(xintercept=c(as.Date("2022-04-01"), as.Date("2022-07-01"), as.Date("2022-10-01")), linetype = 2, color = "black", size = 0.1) +
  geom_text(aes(as.Date("2022-04-01"), 0, label = "End Q1"), size= 3) +
  geom_text(aes(as.Date("2022-07-01"), 0, label = "End Q2"), size= 3) +
  geom_text(aes(as.Date("2022-10-01"), 0, label = "End Q3"), size= 3) +
  theme_classic() +
  theme(panel.grid.major.y = element_line(color = "grey", size = 0.1))

```
Fig. 2 is the cumulative sum of all contributions from 1/1/22 - 10/19/22. You can see both parties spiked at the end of quarter deadlines - at the end of a disclosure period, each campaign has to publicly release their fundraising report for that quarter. Candidates tend to push to bring in as much money as they can so when their records are released they can show fundraising momentum. While both parties spike at EOQ deadlines, the Democrats clearly outperformed the Republicans after Q1. This could be in part due to the fact the Democrats rely more on individual contributions than Republicans - who tend to make up the shortfall in candidate fundraising by large spending from outside groups (https://www.washingtonpost.com/politics/2022/10/07/house-democrats-fundraising/). 

### Fig. 3.
```{r}

# by day
final_receipt_date_party_day <- final_receipt_date %>%
                                  group_by(Party, contribution_receipt_date) %>%
                                  summarise(fundraised = sum(as.double(contribution_receipt_amount)))

ggplot(final_receipt_date_party_day, aes(x = as.Date(contribution_receipt_date)), y = fundraised, color = Party) +
  geom_line(aes(y = fundraised, color = Party)) +
  scale_x_date(limits = as.Date(c("2022-01-01", "2022-10-19"))) +
  labs(title = "Fig. 3 Sum of Individual Contributions by Day for Federal Candidates \nof Each Party", 
       x = "Day of Contribution", 
       y = "Contribution Amount ($)") +
  scale_color_manual(values = c("GOP" = "red", "DEM" = "blue")) +
  geom_vline(xintercept=c(as.Date("2022-05-02"), as.Date("2022-06-24"), as.Date("2022-08-08")), linetype = 2, color = "black", size = 0.1) +
  geom_text(aes(as.Date("2022-05-02"), 12000000, label = "Dobbs Leak"), size= 3) +
  geom_text(aes(as.Date("2022-06-24"), 10000000, label = "Dobbs Decision"), size= 3) +
  geom_text(aes(as.Date("2022-08-08"), 8000000, label = "Trump FBI Raid"), size= 3) +
  theme_classic() +
  theme(panel.grid.major.y = element_line(color = "grey", size = 0.1))

```
Fig. 3 shows the contributions each party brought in by day between 1/1/22 - 10/19/22. The largest spikes correspond with the EOQ deadlines as mentioned in Fig. 2. Also included are the dates of major political shocks - notably the Dobbs decision happened near the end of Q2. The Democrats led that spike in fundraising and then continued the daily lead throughout the next quarter. Also, GOP fundraising did not catch up after the FBI raid on Mar-a-Lago - which became a large part of the fundraising message from the GOP around that time.

### Fig. 4.
```{r}

# by week
final_receipt_date_party_week <- final_receipt_date %>%
                                  mutate(week = week(as.Date(contribution_receipt_date))) %>%
                                  group_by(Party, week) %>%
                                  summarise(fundraised = sum(as.double(contribution_receipt_amount)))

ggplot(final_receipt_date_party_week, aes(x = as.Date(paste(2022, week, 1, sep="-"), "%Y-%U-%u")), y = fundraised, color = Party) +
  geom_line(aes(y = fundraised, color = Party)) +
  scale_x_date(limits = as.Date(c("2022-01-01", "2022-10-19"))) +
  labs(title = "Fig. 4 Sum of Individual Contributions by Week for Federal Candidates \nof Each Party", 
       x = "Week of Contribution", 
       y = "Contribution Amount ($)") +
  scale_color_manual(values = c("GOP" = "red", "DEM" = "blue")) +
  geom_vline(xintercept=c(as.Date("2022-05-02"), as.Date("2022-06-24"), as.Date("2022-08-08")), linetype = 2, color = "black", size = 0.1) +
  geom_text(aes(as.Date("2022-05-02"), 30000000, label = "Dobbs Leak"), size= 3) +
  geom_text(aes(as.Date("2022-06-24"), 28000000, label = "Dobbs Decision"), size= 3) +
  geom_text(aes(as.Date("2022-08-08"), 26000000, label = "Trump FBI Raid"), size= 3) +
  theme_classic() +
  theme(panel.grid.major.y = element_line(color = "grey", size = 0.1))

```
Fig. 4 shows the weekly contributions to each party between 1/1/22 - 10/19/22. Democrats clearly held a fundraising advantage after the Dobbs leak for the rest of the cycle. While most spikes correlate between parties (when one party has a good week, so does the other), there are a few key moments shown where Democrats achieved smaller spikes without seeing a similar trend among Republican candidate fundraising.

### Fig. 5.
```{r}

# look at only competitive districts
# competitive districts defined as districts with + or - 10 ppt difference in 2020 presidential vote share (DEM - GOP)
# by day
final_receipt_date_party_day_competitive <- final_receipt_date %>%
                                              filter(abs(`Dem-Rep.2020`) <= .1) %>%
                                              group_by(Party, contribution_receipt_date) %>%
                                              summarise(fundraised = sum(as.double(contribution_receipt_amount)))

ggplot(final_receipt_date_party_day_competitive, aes(x = as.Date(contribution_receipt_date)), y = fundraised, color = Party) +
  geom_line(aes(y = fundraised, color = Party)) +
  scale_x_date(limits = as.Date(c("2022-01-01", "2022-10-19"))) +
  labs(title = "Fig. 5 Sum of Individual Contributions by Day for Federal Candidates \nof Each Party Running in Competitive Districts", 
       x = "Day of Contribution", 
       y = "Contribution Amount ($)") +
  scale_color_manual(values = c("GOP" = "red", "DEM" = "blue")) +
  geom_vline(xintercept=c(as.Date("2022-05-02"), as.Date("2022-06-24"), as.Date("2022-08-08")), linetype = 2, color = "black", size = 0.1) +
  geom_text(aes(as.Date("2022-05-02"), 7400000, label = "Dobbs Leak"), size= 3) +
  geom_text(aes(as.Date("2022-06-24"), 7000000, label = "Dobbs Decision"), size= 3) +
  geom_text(aes(as.Date("2022-08-08"), 6400000, label = "Trump FBI Raid"), size= 3) +
  theme_classic() +
  theme(panel.grid.major.y = element_line(color = "grey", size = 0.1))

```
Fig. 5 shows the contributions to candidates in competitive districts by party and day between 1/1/22 - 10/19/22. Competitive districts were determined based on the difference in vote share in the 2020 presidential election for each party, excluding any districts that were not within 10% points. Especially as the election came closer, the size of the fundraising gap in competitive districts between parties is more distinct. Democrats held the advantage in daily fundraising from the end of May forward. However, due to the difference in the way the Democrats and Republicans fundraise, the discrepancy can be explained by Republicans relying more on outside spending. More analysis and data on PAC contributions is needed to understand this dynamic.

### Fig. 6.
```{r}

# look at only competitive districts
# competitive districts defined as districts with + or - 10 ppt difference in 2020 presidential vote share (DEM - GOP)
# by week
final_receipt_date_party_week_competitive <- final_receipt_date %>%
                                              filter(abs(`Dem-Rep.2020`) <= .1) %>%
                                              mutate(week = week(as.Date(contribution_receipt_date))) %>%
                                              group_by(Party, week) %>%
                                              summarise(fundraised = sum(as.double(contribution_receipt_amount)))

ggplot(final_receipt_date_party_week_competitive, aes(x = as.Date(paste(2022, week, 1, sep="-"), "%Y-%U-%u")), y = fundraised, color = Party) +
  geom_line(aes(y = fundraised, color = Party)) +
  scale_x_date(limits = as.Date(c("2022-01-01", "2022-10-19"))) +
  labs(title = "Fig. 6 Sum of Individual Contributions by Week for Federal Candidates of \nEach Party Running in Competitive Districts", 
       x = "Week of Contribution", 
       y = "Contribution Amount ($)") +
  scale_color_manual(values = c("GOP" = "red", "DEM" = "blue")) +
  geom_vline(xintercept=c(as.Date("2022-05-02"), as.Date("2022-06-24"), as.Date("2022-08-08")), linetype = 2, color = "black", size = 0.1) +
  geom_text(aes(as.Date("2022-05-02"), 30000000, label = "Dobbs Leak"), size= 3) +
  geom_text(aes(as.Date("2022-06-24"), 28000000, label = "Dobbs Decision"), size= 3) +
  geom_text(aes(as.Date("2022-08-08"), 26000000, label = "Trump FBI Raid"), size= 3) +
  theme_classic() +
  theme(panel.grid.major.y = element_line(color = "grey", size = 0.1))

```
Fig. 6 shows the contributions to candidates in competitive districts by party and week between 1/1/22 - 10/19/22. When broken down to just competitive districts, the 2nd and 3rd EOQ spikes show a more distinctive gap between Dem and GOP fundraising - Democrats dominated individual contributions in these districts. 

### Fig. 7.
```{r}

# show the top fifteen candidates who fundraised the most for each party at each level of office
# House Democrats

final_top_house_dems <- final_house %>%
                          filter(Party == "DEM") %>%
                          top_n(15, total_fundraised_sum)

ggplot(final_top_house_dems, aes(x = total_fundraised_sum, y = reorder(Candidate, total_fundraised_sum), fill = total_fundraised_sum)) +
  geom_bar(stat="identity") +
  geom_text(aes(label=round(total_fundraised_sum / 1000000, 1)), hjust=-0.25) +
  scale_fill_gradient(low="lightblue",high="blue") +
  labs(title = "Fig. 7 Top Fundraisers Among House Democratic Candidates", 
       x = "Contribution Amount ($)", 
       y = "Candidate Name") +
  guides(fill=guide_legend(title="Contribution Amount")) +
  scale_x_continuous(labels=scales::comma, limits = c(0, 7000000)) +
  theme_classic()

```
Fig. 7 shows the 15 highest Democratic fundraisers running for the House in the 2022 Midterms. Most of the candidates were in competitive districts - which explains the wider gap in fundraising by party in these districts in Fig 5. Katie Porter (CA-45), the highest fundraiser on this visual, is one of the most well known members of the Democratic caucus. She has a high national presence and a strong social media following - she also was in a competitive race with a pro-life Republican candidate (https://www.latimes.com/politics/story/2022-10-20/2022-california-midterm-election-porter-baugh-abortion-economy-environment). 4 out of the 15 candidates shown narrowly lost their races. 

### Fig. 8.
```{r}

# show the top fifteen candidates who fundraised the most for each party at each level of office
# House Republicans

final_top_house_gop <- final_house %>%
                          filter(Party == "GOP") %>%
                          top_n(15, total_fundraised_sum)

ggplot(final_top_house_gop, aes(x = total_fundraised_sum, y = reorder(Candidate, total_fundraised_sum), fill = total_fundraised_sum)) +
  geom_bar(stat="identity") +
  geom_text(aes(label=round(total_fundraised_sum / 1000000, 1)), hjust=-0.25) +
  scale_fill_gradient(low="lightcoral",high="red") +
  labs(title = "Fig. 8 Top Fundraisers Among House Republican Candidates", 
       x = "Contribution Amount ($)", 
       y = "Candidate Name") +
  guides(fill=guide_legend(title="Contribution Amount")) +
  scale_x_continuous(labels=scales::comma, limits = c(0, 9500000)) +
  theme_classic()

```
Fig. 8 shows the 15 highest Republican fundraisers running for the House in the 2022 Midterm Election. Most of the candidates shown maintain some sort of presence in the GOP mainstream - Kevin McCarthy, the minority leader, is most likely going to be speaker of the House in January, Elise Stefanik is a rising star in GOP ranks maneuvering from a moderate freshman Republican to ousting Liz Cheny for 3rd in GOP House Leadership, and Jim Jordan one of the most outspoken Trump loyalists. Harriet Hageman, the Trump Loyalist GOP challenger who defeated Cheney in her primary in Wyoming was the 5th highest fundraiser - despite never holding federal office. Interestingly, Republican candidates of color (James, Kim, Ciscomani, Steel…) were all leaders in GOP house candidate fundraising. 

### Fig. 9.
```{r}

# show the top fifteen candidates who fundraised the most for each party at each level of office
# Senate Democrats

final_top_senate_dems <- final_senate %>%
                          filter(Party == "DEM") %>%
                          top_n(15, total_fundraised_sum)

ggplot(final_top_senate_dems, aes(x = total_fundraised_sum, y = reorder(Candidate, total_fundraised_sum), fill = total_fundraised_sum)) +
  geom_bar(stat="identity") +
  geom_text(aes(label=round(total_fundraised_sum / 1000000, 1)), hjust=-0.25) +
  scale_fill_gradient(low="lightblue",high="blue") +
  labs(title = "Fig. 9 Top Fundraisers Among Senate Democratic Candidates", 
       x = "Contribution Amount ($)", 
       y = "Candidate Name") +
  guides(fill=guide_legend(title="Contribution Amount")) +
  scale_x_continuous(labels=scales::comma, limits = c(0, 41000000)) +
  theme_classic()

```
Fig. 9 shows the 15 highest Democratic fundraisers running for Senate in the 2022 Midterm Election. This graph shows almost exclusively senate seats that were at least slightly competitive. 5 out of the 15 candidates lost their election - most notably the 3rd highest fundraiser Val Demmings losing by 16 points to Marco Rubio in Florida.  Meanwhile Mandala Barnes, the Democratic challenger in Wisconsin, lost by just 1 point, despite his opponent Ron Johnson being the highest Republican fundraiser this cycle (Fig 10). Each senate election by state has different factors that influence not only how much money comes in, but how much it affects the final vote count.

### Fig. 10.
```{r}

# show the top fifteen candidates who fundraised the most for each party at each level of office
# Senate Republicans

final_top_senate_gop <- final_senate %>%
                          filter(Party == "GOP") %>%
                          top_n(15, total_fundraised_sum)

ggplot(final_top_senate_gop, aes(x = total_fundraised_sum, y = reorder(Candidate, total_fundraised_sum), fill = total_fundraised_sum)) +
  geom_bar(stat="identity") +
  geom_text(aes(label=round(total_fundraised_sum / 1000000, 1)), hjust=-0.25) +
  scale_fill_gradient(low="lightcoral",high="red") +
  labs(title = "Fig. 10 Top Fundraisers Among Senate Republican Candidates", 
       x = "Contribution Amount ($)", 
       y = "Candidate Name") +
  guides(fill=guide_legend(title="Contribution Amount")) +
  scale_x_continuous(labels=scales::comma, limits = c(0, 18000000)) +
  theme_classic()

```
Fig. 10 shows the 15 highest Republican fundraisers running for Senate in the 2022 Midterm Election. The top Republican fundraiser Ron Johnson raised less than half then the top 2 Democratic fundraisers, Kelly and Warnock - as Republicans rely more on Super Pacs than individual contributions. Johnson raised about $1.1m less than his opponent Mandela Barnes. It’s also interesting how large the fundraising discrepancy is between the candidates in extremely competitive districts. Walker, Oz, Vance, and Masters were all in battleground states from 2020 so we would expect their fundraising would be stronger. Vance, who raised the least of those 4 candidates, was the only one to win his Senate bid - despite Tim Ryan outraising him 3 to 1. It’s also interesting that two of the highest fundraisers, Murkowski and Tshibaka, were actually opponents in the Alaska Senate election - Murkowski, the incumbent who raised about 20-25% more, won.

### Fig. 11.
```{r}

# look at where contributions originated and went to by state and by party

final_receipt_date_contributor_state <- final_receipt_date %>%
                                          group_by(Party, contributor_state) %>%
                                          summarise(`Origin Contribution Amount` = sum(as.double(contribution_receipt_amount)))

final_receipt_date_candidate_state <- final_receipt_date %>%
                                          group_by(Party, State, State_processed) %>%
                                          summarise(`Destination Contribution Amount` = sum(as.double(contribution_receipt_amount)))

# For Democratic candidates
joined_state_dem <- left_join(final_receipt_date_contributor_state, final_receipt_date_candidate_state, by = c("contributor_state" = "State_processed", "Party" = "Party")) %>%
                  filter(!is.na(State), Party == "DEM") %>%
                  top_n(10, `Destination Contribution Amount`)

joined_state_dem_m <- melt(joined_state_dem[,c('State',"Destination Contribution Amount","Origin Contribution Amount")],id.vars = 1)

ggplot(joined_state_dem_m, aes(x = value, y = reorder(State, value))) +
  geom_bar(aes(fill = variable), stat="identity", position = "dodge") +
  labs(title = "Fig. 11 Top 10 States by Fundraising Amount for Democratic Candidates", 
       x = "Contribution Amount ($)", 
       y = "State") +
  scale_x_continuous(labels=scales::comma) +
  guides(fill=guide_legend(title="")) +
  theme_classic()

```
Fig. 11 shows the top 10 states that donated to Democratic candidates this cycle with the amount contributed by donors within the state in cyan and the amount raised by candidates running in the state in orange. California was by far the state with the most amount fundraised by donors living in the state, much in part due to the high population of the state as well as Democrats being viewed more favorably there. California also had relatively high fundraising numbers for candidates running in the state, but can most likely be attributed to the high number of house races in the state. States like Arizona, Georgia, Pennsylvania, Ohio, Nevada, and Wisconsin had relatively high fundraising amounts compared to the amount of donations that originated there, which makes sense given that these are battleground states with highly contested races.

### Fig 12.
```{r}

# For Republican candidates
joined_state_dem <- left_join(final_receipt_date_contributor_state, final_receipt_date_candidate_state, by = c("contributor_state" = "State_processed", "Party" = "Party")) %>%
                  filter(!is.na(State), Party == "GOP") %>%
                  top_n(10, `Destination Contribution Amount`)

joined_state_dem_m <- melt(joined_state_dem[,c('State',"Destination Contribution Amount","Origin Contribution Amount")],id.vars = 1)

ggplot(joined_state_dem_m, aes(x = value, y = reorder(State, value))) +
  geom_bar(aes(fill = variable), stat="identity", position = "dodge") +
  labs(title = "Fig. 12 Top 10 States by Fundraising Amount for Republican Candidates", 
       x = "Contribution Amount ($)", 
       y = "State") +
  scale_x_continuous(labels=scales::comma) +
  guides(fill=guide_legend(title="")) +
  theme_classic()

```
Fig. 12's visual shows the top 10 states that donated to Republican candidates this cycle with the amount contributed by donors within the state in cyan, and the amount raised by candidates running in the state in orange. Republicans had high origin contribution amounts from populous states like Florida, California, and Texas. Similar to Democrats, Arizona, Georgia, Pennsylvania, Wisconsin, and Ohio saw a higher amount fundraised by candidates running in those states than fundraised from contributors living in those states.


### Analysis

This section presents the main results, such as (for example) stats and graphs that show relationships, model results and/or clustering, PCA, etc.

```{r}

# build linear model for each office level for fundraising
# house of representatives
house_model <- glm(total_fundraised_sum ~ . - Candidate - State - State_processed - District - Party, data = final_house, family="gaussian")
summary(house_model)

```
In this model looking at House candidates, Party Committee and Emily's List endorsements as well as win status were found to be statistically significant at 95% confidence in increasing fundraising for the candidate. Native American status is statistically significant at 90% confidence.

```{r}

# plot basic visuals of the model
plot(house_model)

```

```{r}

# build linear model for each office level for fundraising
# senate model
senate_model <- glm(total_fundraised_sum ~ . - Candidate - State_processed - State - Party, data = final_senate, family="gaussian")
summary(senate_model)

```
This model shows that among Senate candidates, being endorsed by Emily’s List was found to be the only statistically significant influence on fundraising, to the 95% confidence level.

```{r}

# plot basic visuals of the model
plot(senate_model)

```

```{r}

# build linear model for each office level for fundraising
# competitive districts
competitive_model <- glm(total_fundraised_sum ~ . - Candidate - State - State_processed - Party, data = final_competitive, family="gaussian")
summary(competitive_model)

```
Among competitive districts, only Senator status was found to be statistically significant with incumbency status having a p-value lower than 0.1, but not low enough to be significant at 95% confidence.

```{r}

# plot basic visuals of the model
plot(competitive_model)

```


```{r}

# build logistic model for probability of winning
# house of representatives
house_model2 <- glm(Winner.Num ~ . - Candidate - State - State_processed - District - Party, data = final_house, family="binomial")
summary(house_model2)

```
This model shows what characteristics affect House candidate’s chances of winning. GOP candidates, incumbents, total fundraised and Pres. 2020 variables were found to be statistically significant at 95% confidence.

```{r}

# plot basic visuals of the models
plot(house_model2)

```

```{r}

# build logistic model for probability of winning
# senate
senate_model2 <- glm(Winner.Num ~ . - Candidate - State - State_processed - Party, data = final_senate, family="binomial")
summary(senate_model2)

```
This model among Senate candidates shows no variables were statistically significant in predicting winning outcome. This is most likely due in part to low N observations.

```{r}

# plot basic visuals of the models
plot(senate_model2)

```


```{r}

# build logistic model for probability of winning
# competitive
competitive_model2 <- glm(Winner.Num ~ . - Candidate - State - State_processed - Party, data = final_competitive, family="binomial")
summary(competitive_model2)

```
Among competitive districts, incumbency status, presidential vote share in 2020, GOP status, Latino status, and percentage white in district, were found to be statistically significant at 95% confidence in predicting win.

```{r}

# plot basic visuals of the model
plot(competitive_model2)

```

```{r}

# conduct principal component analysis for each data set

# for house
final_house_pca <-
  as.data.frame(final_house) %>%
  select(-Candidate, -State, -State_processed, -Party, -District) %T>%
  pairs(.)

pca_house <- prcomp(x = final_house_pca, 
                  scale. = TRUE)
summary(pca_house)
fviz_screeplot(pca_house)

```
All 10 dimensions explain portion of variance around 5% or greater with dimensions 9 and 10 being slightly lower.

```{r}

# for senate
final_senate_pca <-
  as.data.frame(final_senate) %>%
  select(-Candidate, -State, -State_processed, -Party) %T>%
  pairs(.)

pca_senate <- prcomp(x = final_senate_pca, 
                  scale. = TRUE)
summary(pca_senate)
fviz_screeplot(pca_senate)

```
All 10 dimensions explain portion of variance around 5% or greater with dimensions 9 and 10 being slightly lower.

```{r}

# for competitive districts
final_competitive_pca <-
  as.data.frame(final_competitive) %>%
  select(-Candidate, -State, -State_processed, -Party, -Renew.America.Num) %T>%
  pairs(.)

pca_competitive <- prcomp(x = final_competitive_pca, 
                  scale. = TRUE)
summary(pca_competitive)
fviz_screeplot(pca_competitive)

```
All 10 dimensions explain portion of variance around 5% or greater with dimensions 9 and 10 being slightly lower.

## Discussion

This section summarizes the results and may briefly outline advantages and limitations of the work presented.

Between the two parties, Democrats had a better fundraising performance from individual contributions in the 2022 Midterm Election. We saw a distinct gap between fundraising trends after abortion became a more salient political issue. Before the Dobbs leak on May 2nd, 2022, both parties were fundraising at about the same rate. For Democrats, while the Dobbs decision was a blow to their greater agenda, it was a watershed moment for their fundraising. Presidential approval rating was low, the global markets had been turbulent, and inflation was at record highs - enthusiasm for fundraising was low. However, Dobbs gave Democrats a unifying rallying call in their messaging that changed the trajectory of their fundraising - and in turn their chances to win. 

A plurality of Democratic candidates ran on the message of Choice, and as was seen with the Kansas abortion referendum and Democratic over performance in key special elections in Alaska, Wisconsin and New York. In our results, an endorsement from Emily’s List, a pro-choice woman organization, significantly improved fundraising numbers for those candidates. High fundraising is indicative of a greater chance of winning, so every year candidate’s are striving to raise more than ever. Based on these trends, Democrats' over performance in fundraising in the months leading up to the elections, also indicated the potential of over performing election expectations - despite the fundamentals being against them (Pres. Approval, Economy, and Party out-of-power midterm advantage).

One of the advantages of our work is being able to identify key candidate characteristics for the primaries, such as endorsements, fundraising numbers, district characteristics, and candidate demographics. It also allows us to look at both fundraising expectations and expectations of winning the election. Some of the disadvantages we found were that the FEC data did not include the final weeks of the election cycle. Also, the FEC only has reporting for individuals contributing over $200 and not all PAC money is included. The FEC API was difficult to incorporate into our analysis given its complications in processing the relevant information we needed. Even the FEC website interface itself was difficult to manage. If the API had worked, it would have streamlined our data collection process and made it easier to analyze updated FEC data.

Given the fact that the Dobbs decision happened near the end of a fundraising quarter, another disadvantage is that it is harder to clearly distinguish the full “Dobbs effect” from the general EOQ fundraising trends. If we had more time we would have further removed outliers and optimized our models, making sure we’re watching for variance - and using the results of PCA to fine tune our model. Some further research we could do includes: checking the vote margins for the 2022 election compared to past cycles, updating our analysis once FEC reports are finalized (data past Oct 19th), research on fundraising language and methods used by each candidate to see the prevalence of keywords related to major political shocks and to see which methods were more effective. The 2022 midterm election cycle was unique in political history and more research on this election cycle may provide meaningful insight into future elections.


## References
Open Secrets (2003), Election Overview: Cost of the Election. Washington, DC: Center for Responsive Politics. https://www.opensecrets.org/elections-overview/cost-of-election

Open Secrets (2003), Election Overview: Did Money Win?. Washington, DC: Center for Responsive Politics.
https://www.opensecrets.org/elections-overview/winning-vs-spending

New York Times (2022), House Election Tracker https://www.nytimes.com/news-event/2022-midterm-elections

New York Times (2022), Senate Election Tracker https://www.nytimes.com/news-event/2022-midterm-elections

Politico (2022), Read Justice Alito's initial draft abortion opinion which would overturn Roe v. Wade
https://www.politico.com/news/2022/05/02/read-justice-alito-initial-abortion-opinion-overturn-roe-v-wade-pdf-00029504 

Supreme Court Dobbs Decision
https://www.supremecourt.gov/opinions/21pdf/19-1392_6j37.pdf 

United States (1997). U.S. Federal Election Commission FEC
https://www.fec.gov/data

Dave’s Redistricting App
https://davesredistricting.org/maps#home

Scherer, M. (2022). Democrats sound alarms about funding in battle for House majority. The Washington Post. https://www.washingtonpost.com/politics/2022/10/07/house-democrats-fundraising/ 

Fry, H. (2022). Where do rep. Katie Porter and Scott Baugh stand on abortion, inflation, immigration? Los Angeles Times. https://www.latimes.com/politics/story/2022-10-20/2022-california-midterm-election-porter-baugh-abortion-economy-environment 

FiveThiryEight (2022) Primary Project 2022 https://github.com/fivethirtyeight/data/tree/master/primary-project-2022